{% extends 'base.html' %}
{% block content %}

<h1>Event Details</h1>

<div class="card">
  <div class="card-content">
    <span class="card-title">{{ event.event_name }}</span>
  <div>

   <!-- Insert photo markup below this comment -->
    {% for photo in event.photo_set.all %}
      <img class="responsive-img card-panel" src="{{photo.url}}">
    {% empty %}
      <div class="card-panel teal-text center-align">No Photos Uploaded</div>
    {% endfor %}

{% if user == event.user %}
    <form action="{% url 'add_photo' event.id %}" enctype="multipart/form-data" method="POST" class="card-panel">
    {% csrf_token %}
    <input type="file" name="photo-file">
    <br><br>
    <input type="submit" class="btn" value="Upload Photo">
{% endif %}

</form>
  
  </div>

    <h5>Host: {{ event.user }}</h5>
    <h5>Location: {{ event.location }}</h5>
    {% if event.rating_set.all %}
    <h5>Rating: {{ rating_avg|floatformat }}</h5>
    {% else %}
    <div class="card-panel teal-text center-align">No Ratings</div>
    {% endif %}
    
<div class="row">
<div class="col s9">
    <form action="{% url 'add_comment' event.id %}" method="POST">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <input type="submit" class="btn" value="Add Comment">
    </form>
</div>

    <div class="col s3">
    <form action="{% url 'add_rating' event.id %}" method="POST">
      {% csrf_token %}
      {{ rating_form.as_p }}
      <input type="submit" class="btn" value="Add Rating">
    </form>
    </div>
</div>

  <div>
    {% if event.comment_set.all %}
    <table class="striped">
      <thead>
        <tr>
          <th><i class="small material-icons">comment</i></th>
          <th><i class="small material-icons">date_range</i></th>
          <th><i class="small material-icons">account_circle</i></th>
        </tr>
      </thead>

      <tbody>
        {% for comment in event.comment_set.all %}
        <tr>
          <td>{{ comment.comment }}</td>
          <td>{{comment.date}}</td>
          <td>{{comment.user}}</td>
          <td><a href="{% url 'update_comment' comment.id %}"><i class="small material-icons">update</i></a></td>
          <td><a href="{% url 'delete_comment' comment.id %}"><i class="small material-icons">delete_forever</i></a></td>
        </tr>
        {% endfor %}
      </tbody>
      {% else %}
      <div class="card-panel teal-text center-align">No Comments Yet</div>
      {% endif %}
    </table>
  </div>
</div>

  <div class="card-action">
    <a href="{% url 'events_update' event.id %}">Edit Event</a>
    <a href="{% url 'events_delete' event.id %}">Delete Event</a>
  </div>

</div>

<script>
  const selectEl = document.getElementById("id_rating");
  M.FormSelect.init(selectEl);
</script>

{% endblock %}